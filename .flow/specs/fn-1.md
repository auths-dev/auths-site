# Auths Public Portal — Zero-Trust Showcase

## Overview

Consolidate `auths-verify-widget` into `auths-site` as a pnpm workspace monorepo, then build the full public portal showcasing zero-trust, decentralized cryptographic identity verification via WebAssembly.

**The "holy shit" moment**: A user drops a binary into their browser. Nothing uploads. A WASM engine (compiled from Rust) verifies a decentralized cryptographic signature instantly. No central authority. Why hasn't it always been this way?

## Monorepo Structure

```
auths-site/
├── pnpm-workspace.yaml       # packages: ["apps/*", "packages/*"]
├── package.json              # root: ESLint, Prettier, TypeScript
├── apps/
│   └── web/                  # Next.js 15 App Router
│       ├── content/          # .md/.mdx files (docs, blog, trust)
│       ├── src/app/          # routes: /, /explorer, /verify, /(content)/[...slug]
│       └── package.json      # "auths-verify": "workspace:*"
└── packages/
    └── widget/               # migrated auths-verify-widget
        ├── src/              # web component, resolvers, verifier-bridge
        ├── wasm/             # committed WASM binary (not gitignored in monorepo)
        └── package.json      # name: "auths-verify"
```

## Scope

**In scope:**
- pnpm workspace initialization and widget migration (Task 1)
- Next.js 15 app scaffold + navigation layout + hero with live widget (Task 2)
- Widget resolver export cleanup for use in Next.js (Task 3)
- Identity Explorer `/explorer` with KEL timeline (Task 4)
- Static MDX content pages: Docs, Blog, Trust (Task 5)
- `/verify?commit=...` route with OpenGraph SSR via `generateMetadata` (Task 6)

**Out of scope:**
- Rewriting WASM bridge (use existing `verifier-bridge.ts` as-is)
- GitLab support (stub exists, leave as stub)
- GitHub API authentication proxy (MVP: unauthenticated, 60 req/hr)
- i18n, analytics, RSS feeds, docs versioning

## Architectural Decisions

### Widget Consumption: Pre-built Dist
The widget is a Vite library build. Next.js uses webpack/Turbopack. These bundlers are not compatible for WASM loading (`vite-plugin-wasm` vs `asyncWebAssembly` experiment).

**Decision**: Import `packages/widget` output (`dist/auths-verify.mjs`) in Next.js, not source. Add `"auths-verify": "workspace:*"` to `apps/web/package.json` and `transpilePackages: ["auths-verify"]` to `next.config.ts` only if needed for types; for the web component use dynamic import.

### WASM Binary: Committed to Monorepo
The `wasm/` directory is gitignored in the source widget repo (generated by wasm-pack from `../auths/`). For the monorepo, the pre-built `wasm/auths_verifier_bg.wasm` (352KB) is **committed** to `packages/widget/wasm/`. The gitignore entry is removed from the widget's `.gitignore` within the monorepo.

CI does not need Rust toolchain unless someone runs `pnpm widget:build:wasm`. The WASM binary is a stable artifact.

### `@auths/verifier` External Dependency
The TypeScript types package (`@auths/verifier`) lives in the sibling `../auths/packages/auths-verifier-ts/` repo. It is kept as a `file:` reference in `packages/widget/package.json`. The relative path adjusts from `../auths/...` to `../../auths/...` (one level deeper due to `packages/widget/` nesting within the monorepo).

All four files that reference this path must be updated: `package.json`, `tsconfig.json`, `vite.config.ts`, `vitest.config.ts`.

### Explorer Data: Attestation Chain as KEL
The existing `resolveFromRepo()` returns `IdentityBundle.attestation_chain: object[]`. The Explorer timeline maps this array directly — each item is a "KEL event" with `seq`, `timestamp`, and `data`. No new KERI infrastructure is built.

### `/verify` Query Parameter: `repo` + `commit`
The spec says `?commit=...`. The existing resolver operates on repo URLs, not commit SHAs. Decision:
- Primary parameter: `?repo=<github.com/org/repo>` (feeds into resolver)
- Optional secondary: `?commit=<sha>` (used for display in OG metadata)
- The `generateMetadata` function calls `resolveFromRepo(repo)` server-side and shows the result

### Design System
- `#09090b` background, pure white text
- Accent: `#10b981` (Verified Green) — ONLY appears on successful verification
- Prose: Inter/Geist sans-serif + JetBrains Mono/Geist Mono for hashes/DIDs
- Animations: `motion/react` (formerly `framer-motion`) — snappy, not floaty
- shadcn/ui with Tailwind CSS v4, `new-york` style

## Quick Commands

```bash
# Install all workspace deps
pnpm install

# Dev server (Next.js app)
pnpm --filter @auths/web dev

# Build widget
pnpm --filter auths-verify build

# Run widget tests
pnpm --filter auths-verify test

# Smoke test: site loads
curl -s http://localhost:3000 | grep -q "Auths" && echo "OK"

# Smoke test: explorer route exists
curl -s http://localhost:3000/explorer | grep -q "Identity Explorer" && echo "OK"

# Smoke test: verify route returns OG metadata
curl -s "http://localhost:3000/verify?repo=github.com/test/test" | grep -q "og:title" && echo "OK"
```

## Acceptance Criteria

- [ ] `auths-site/` is a valid pnpm workspace with `apps/web` and `packages/widget`
- [ ] `pnpm install` succeeds from monorepo root
- [ ] `packages/widget` builds with `pnpm build` (both full and slim modes)
- [ ] `packages/widget` tests pass (`pnpm test`)
- [ ] `apps/web` starts dev server without errors
- [ ] Landing page `/` renders `<auths-verify>` web component
- [ ] WASM loads in browser (no console errors related to WebAssembly)
- [ ] `/explorer` renders search input and empty state
- [ ] `/explorer?repo=github.com/...` renders attestation timeline (or error state)
- [ ] `/docs/intro` (or equivalent slug) renders MDX content
- [ ] `/verify?repo=...` page generates correct `og:title` via `generateMetadata`
- [ ] All TypeScript: `pnpm typecheck` passes
- [ ] No `console.error` in production build

## Risks & Mitigations

| Risk | Likelihood | Mitigation |
|------|-----------|------------|
| Vite WASM plugin incompatible with Next.js webpack | High | Use pre-built dist; WASM loads from within widget bundle |
| `@auths/verifier` path breaks after widget move | High | Update all 4 path references in Task 1 |
| GitHub API rate limit (60/hr unauthenticated) | Medium | Accept for MVP; add proxy route in follow-up |
| Custom element SSR hydration mismatch | Medium | Wrap in `'use client'` + `useEffect(() => import(...))` |
| WASM fails in Safari Private Browsing | Low | Show graceful "WASM not supported" fallback in widget |

## References

- Widget source: `/Users/bordumb/workspace/repositories/auths-base/auths-verify-widget/`
- WASM binary: `auths-verify-widget/wasm/auths_verifier_bg.wasm` (352KB)
- Resolver barrel: `auths-verify-widget/src/resolvers/index.ts`
- Verifier bridge: `auths-verify-widget/src/verifier-bridge.ts`
- pnpm workspaces: https://pnpm.io/workspaces
- Next.js transpilePackages: https://nextjs.org/docs/app/api-reference/config/next-config-js/transpilePackages
- Next.js generateMetadata: https://nextjs.org/docs/app/api-reference/functions/generate-metadata
- next-mdx-remote: https://github.com/hashicorp/next-mdx-remote
- TanStack Query SSR: https://tanstack.com/query/latest/docs/framework/react/guides/advanced-ssr
- shadcn/ui monorepo: https://ui.shadcn.com/docs/monorepo
- Motion (Framer): https://motion.dev/docs/react-layout-animations

## Open Questions

1. **`@auths/verifier` long-term**: Should this package be published to npm to remove the file: dependency? (Defer — use file: for now)
2. **GitHub API proxy**: Add a `/api/resolve?repo=...` route to use a server-side token? (Defer to follow-up epic)
3. **Widget publish**: After monorepo migration, should `packages/widget` still be publishable to npm? (Yes — preserve name/version/exports)
4. **Deployment target**: Vercel vs Cloudflare vs self-hosted? (Assume Vercel; adjust `next.config.ts` output if needed)
